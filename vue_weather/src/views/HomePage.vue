<template>
  <div class="text-secondary">
    <!-- <h1>Weather</h1> -->
    <div class="bg-orange-900  ">Search</div>
    <div class="flex flex-row">
      
      
      <!-- left element -->
      <div class="flex-col  w-[60%]">
        <div v-show="weather">
        <!-- <div > -->
          <div class="flex flex-row justify-between ">
            <div class="w-[70%] flex flex-col justify-between h-[200px] py-4">
              <div>
                <h1 class="text-white text-2xl "> {{weather.name}} </h1>
                <h1 class="text-secondary "> {{ timezone }}</h1>
              </div>
              <h1 class="items-end text-white font-bold tracking-wide	 text-4xl"> {{ current_data_weather.main }} {{ weather.main.temp }} ¬∞C</h1>
            </div>

            <div class=" w-[30%] flex justify-center	items-center ">
              <img v-show="current_data_weather" class="w-15 h-[150px]" :src="current_data_weather.icon" alt="Weather Icon">
            </div>
          </div>



          <div class="bg-second rounded-2xl p-4">
            <div>Data</div>
            <div class="grid grid-cols-2 mt-5 gap-6">
              <div class="flex " v-for="(weather) in dataOfWeather" :key="weather.title">
                <img :src=weather.image alt="Humidity" class="w-[25px] h-[25px]">
                <div class="ml-1 border-l-4 pl-2 border-first">
                  <p class="text-base">{{weather.title}}:</p>
                  <h5 class="text-white font-bold text-2xl ">{{weather.data}} </h5>
                </div>
              </div>
            </div>

          </div>
          
        </div>
      </div>
      






      <!-- right element -->
      <div class="flex flex-col w-[40%]">
        ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏Ç‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
      </div>




    </div>




  </div>
</template>

<script>
import axios from 'axios';
export default {
  name: "HomePage",
  data() {
    return {
      weather: null,
      apiKey: process.env.VUE_APP_OPENWEATHERMAP_API_KEY,
      dataOfWeather : [],
      timezone: "",
      current_data_weather: null,
    }
  },
  created() {
    this.getLocation();
  },
  methods: {
    getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(this.getWeather, this.showError);  // this.getWeather: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô callback ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏•‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ñ‡∏π‡∏Å‡∏î‡∏∂‡∏á‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏£‡∏±‡∏ö parameter ‡πÄ‡∏õ‡πá‡∏ô object position ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î latitude ‡πÅ‡∏•‡∏∞ longitude

      } else {
        alert("Geolocation is not supported by this browser.");
      }
    },
    async getWeather(position) {
      // async ‡∏°‡∏±‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ö‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Ç‡∏±‡∏î‡∏Ç‡∏ß‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô async ‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Promise ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏ã‡∏∂‡πà‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ .then() ‡∏´‡∏£‡∏∑‡∏≠ await ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
      try {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        // console.log(lat , lon);
        // ‡πÉ‡∏ä‡πâ await ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏à‡∏≤‡∏Å axios.get()
        // ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô async ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î await ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API
        const response = await axios.get(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${this.apiKey}`);

        const response_daily = await axios.get(`https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&exclude=daily&appid=${this.apiKey}`)

        const response_forecase_thirtyDay = await axios.get(`http://api.openweathermap.org/data/2.5/forecast?id=524901&appid=${this.apiKey}`)
        // const response_forecase_thirtyDay = await axios.get(`https://pro.openweathermap.org/data/2.5/forecast/climate?lat=35&lon=139&appid=${this.apiKey}`)
        // const response_forecase_thirtyDay = await axios.get(`https://pro.openweathermap.org/data/2.5/forecast/climate?lat=${lat}&lon=${lon}&appid=${this.apiKey}`)

        console.log("response_forecase_thirtyDay üîÜüîÜ: " , response_forecase_thirtyDay);

        console.log("daily ", response_daily);

        // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ï‡πâ ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®
        let city = response_daily.data.timezone.split('/')
        let timezone_data = `${city[1]} ${response.data.sys.country} , ${city[0]}`; // Bangkok TH , Asia
        this.timezone = timezone_data;

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô weather
        console.log("data I received from weather api :", response.data);
        // ‚Å°‚Å¢‚Å£‚Å¢Set weather information‚Å° 
        this.weather = response.data;
        // console.log("this.weather.rain : ",this.weather.rain);
        this.dataOfWeather.push(
          {id:1, title:"Humidity" , data: `${this.weather.main.humidity} %`, image: require('@/assets/icon/humidity.png')}, 
          {id:2, title:"Wind Speed" , data: `${this.weather.wind.speed} m/s` , image: require('@/assets/icon/wind_speed.png')},
          {id:3, title:"Cloudiness " , data: `${this.weather.clouds.all} %` , image: require('@/assets/icon/cloud.png')},
          {id:3, title:"Rain volume " , data: `${this.weather.rain['1h']} mm` , image: require('@/assets/icon/rain_icon_data.png')},
          // {id:3, title:"rain" , data: `${this.weather.rain} mm` , image: require('@/assets/icon/wind_speed.png')},
        )
        
        
        var weather_now = response.data.weather[0]; // weather_now = {id: 801, main: 'Clouds', description: 'few clouds', icon: '02n'}
        console.log("weather_now : ", weather_now);

        // All condition ==> https://openweathermap.org/weather-conditions
        if(weather_now.main == "Clouds"){
          weather_now.icon = require("@/assets/icon/Clouds.png"); 
        }
        else if(weather_now.main == "Rain"){
          weather_now.icon = require("@/assets/icon/Rain.png"); 
        }
        else if(weather_now.main == "Thunderstorm"){
          weather_now.icon = require("@/assets/icon/Thunderstorm.png"); 
        }
        else if(weather_now.main == "Drizzle"){
          weather_now.icon = require("@/assets/icon/Drizzle.png"); 
        }
        else if(weather_now.main == "Snow"){
          weather_now.icon = require("@/assets/icon/Snow.png"); 
        }
        else if(weather_now.main == "Atmosphere"){
          weather_now.icon = require("@/assets/icon/Atmosphere.png"); 
        }
        else if(weather_now.main == "Clear"){
          weather_now.icon = require("@/assets/icon/Clear.png"); 
        }

        this.current_data_weather = weather_now;
        // "Clouds"


      } catch (error) {
        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
        console.error("Error fetching weather data:", error.response ? error.response.data : error.message);
      }
    },
    showError(error) {
      switch(error.code) {
        case error.PERMISSION_DENIED:
          alert("User denied the request for Geolocation.");
          break;
        case error.POSITION_UNAVAILABLE:
          alert("Location information is unavailable.");
          break;
        case error.TIMEOUT:
          alert("The request to get user location timed out.");
          break;
        case error.UNKNOWN_ERROR:
          alert("An unknown error occurred.");
          break;
      }
    }
  }
}
</script>
